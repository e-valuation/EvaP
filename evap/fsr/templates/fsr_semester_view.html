{% extends "fsr_semester_base.html" %}

{% load i18n %}
{% load static %}
{% load morefilters %}

{% block content %}
    {{ block.super }}
    
    <p>
        <a href="{% url "evap.fsr.views.semester_edit" semester.id %}" class="btn small">{% trans "Edit Semester" %}</a>
        {% if semester.can_fsr_delete %}
            <a href="{% url "evap.fsr.views.semester_delete" semester.id %}" class="btn small danger">{% trans "Delete Semester" %}</a>
        {% else %}
            <a href="#" class="btn small danger disabled">{% trans "Delete Semester" %}</a>
        {% endif %}
        &nbsp;
        <a href="{% url "evap.fsr.views.course_create" semester.id %}" class="btn small">{% trans "Create Course..." %}</a>
        <a href="{% url "evap.fsr.views.semester_import" semester.id %}" class="btn small">{% trans "Import Courses" %}</a>
        <a href="{% url "evap.fsr.views.semester_assign_questionnaires" semester.id %}" class="btn small">{% trans "Assign Questionnaires" %}</a>
        &nbsp;
        <a href="{% url "evap.fsr.views.semester_lottery" semester.id %}" class="btn small">{% trans "Lottery" %}</a>
    </p>
    
    {% if courses_by_state %}
            <div id="tab-content">
            {% for state, courses in courses_by_state %}
                <div id="tab{{ forloop.counter }}">
                <h3>{% trans "State" %}: <span>{{ state|statename }} ({{ courses|length }})</span></h3>
                <table class="zebra-striped vertically-aligned">
                <tbody>
                {% for course in courses %}
                    <tr>
                        <td class="maximize">
                            <div>
                            {% if course.can_fsr_edit %}
                                <a href="{% url "evap.fsr.views.course_edit" semester.id course.id %}">{{ course.name }}</a>
                            {% else %}
                                {{ course.name }}
                            {% endif %}
                            </div>
                            <div style="font-style: italic">
                                {{ course.first_lecturer.userprofile.full_name }}
                            </div>
                            <span class="label">{{ course.degree }}</span>
                            <span class="label">{{ course.kind }}</span>
                            {% for warning in course.warnings %}
                                <span class="label important">{{ warning }}</span>
                            {% endfor %}
                        </td>
                        <td class="minimize">{{ course.vote_start_date|date:"SHORT_DATE_FORMAT" }} - {{ course.vote_end_date|date:"SHORT_DATE_FORMAT" }}</td>
                        {% if state == 'inEvaluation' or state == 'evaluated' or state == 'reviewed' or state == 'published' %}
                            {% if course.num_participants %}
                                <td class="dontbreak right">
                                    <span title="{% trans "Participants" %}">{{ course.num_voters }}/{{ course.num_participants }}</span>
                                    <span title="{% trans "Text Answers" %}">{{ course.checked_textanswer_set|length }}/{{ course.textanswer_set|length }}</span>
                                </td>
                                <td class="dontbreak">
                                    <span>({{ course.num_voters|percentage:course.num_participants|default:'&mdash;' }})</span>
                                    <span>({{ course.checked_textanswer_set.count|percentage:course.textanswer_set.count|default:'&mdash;' }})</span>
                                </td>
                            {% else %}
                                <td class="center" colspan="2">&mdash;</td>
                            {% endif %}
                        {% endif %}
                        <td class="minimize">
                            <a href="{% url "evap.fsr.views.course_email" semester.id course.id %}" class="btn small">{% trans "Email" %}</a>
                            <a href="{% url "evap.fsr.views.course_preview" semester.id course.id %}" class="btn small">{% trans "Preview" %}</a>
                            {% if course.can_fsr_delete %}
                                <a href="{% url "evap.fsr.views.course_delete" semester.id course.id %}" class="btn small danger">{% trans "Delete" %}</a>
                            {% endif %}
                            {% if course.can_fsr_review %}
                                <a href="{% url "evap.fsr.views.course_review" semester.id course.id %}" class="btn small">{% trans "Review" %}</a>
                            {% endif %}
                            {% if state == 'inEvaluation' or state == 'evaluated' or state == 'reviewed' or state == 'published' %}
                                <a href="{% url "evap.fsr.views.course_comments" semester.id course.id %}" class="btn small">{% trans "Comments" %}</a>
                            {% endif %}
                            {% if state == 'published' %}
                                <a href="{% url "evap.fsr.views.course_unpublish" semester.id course.id %}" title="{% trans "Unpublish" %}" class="btn small">{% trans "Unpublish" %}</a>
                            {% endif %}
                        </td>
                    </tr>
                {% endfor %}
                </tbody>
                </table>
                
                <p>
                {% ifequal state "new" %}
                    <a class="btn" href="{% url "evap.fsr.views.semester_lecturer_ready" semester.id %}">{% trans "Enable Courses for Lecturer Review" %}</a>
                {% endifequal %}
                {% if state == 'new' or state == 'prepared' or state == 'lecturerApproved' %}
                    <a class="btn" href="{% url "evap.fsr.views.semester_approve" semester.id %}">{% trans "Approve Courses" %}</a>
                {% endif %}
                
                {% ifequal state "lecturerApproved" %}
                    <a class="btn" href="{% url "evap.fsr.views.semester_lecturer_ready" semester.id %}">{% trans "Re-Enable Courses for Lecturer Review" %}</a>
                {% endifequal %}
                
                {% ifequal state "reviewed" %}
                    <a class="btn" href="{% url "evap.fsr.views.semester_publish" semester.id %}">{% trans "Publish Courses" %}</a>
                {% endifequal %}
                </p>
                <p>&nbsp;</p>
                </div>
            {% endfor %}
            </div>
    {% else %}
        <p>{% trans "There are no courses for this semester yet." %}</p>
    {% endif %}
{% endblock %}

{% block scripts %}
    {{ block.super }}
    <script type="text/javascript" src="{% get_static_prefix %}js/bootstrap-tabs.js"></script>
    <script>
        $(function () {
            var tabs = $("<ul class='tabs'/>")
            $('#tab-content > div').each(function(i,e) {
                tabs.append($("<li/>").append($("<a/>", {href: "#" + e.id}).text($('h3 span', e).text())));
            });
            $('#tab-content').addClass('tab-content');
            $(tabs).insertBefore($('#tab-content')).tabs();
            $('#tab-content h3').remove();
            // select first tab
            $('#tab-content > div:first-child').addClass('active');
            $('ul.tabs > li:first-child').addClass('active');
        });
    </script>
{% endblock %}
