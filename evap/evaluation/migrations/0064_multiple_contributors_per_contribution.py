# Generated by Django 2.0.2 on 2018-03-12 17:36

from django.conf import settings
from django.db import migrations, models
import django.db.models.deletion


# Functions from the following migrations need manual copying.
# Move them and any dependencies into this file, then update the
# RunPython operations to refer to the local versions:
# evap.evaluation.migrations.0065_auto_20180226_1823

class Migration(migrations.Migration):

    def add_contributors_forward(apps, schema_editor):
        Contribution = apps.get_model('evaluation', 'Contribution')
        for contribution in Contribution.objects.all():
            if contribution.contributor:
                contribution.contributors.add(contribution.contributor)

    def add_contributors_backward(apps, schema_editor):
        Contribution = apps.get_model('evaluation', 'Contribution')
        for contribution in Contribution.objects.all():
            if contribution.contributors:
                contribution.contributor = contribution.contributors[0]


    dependencies = [
        ('evaluation', '0063_add_heading_question_type'),
    ]

    operations = [
        migrations.AddField(
            model_name='contribution',
            name='contributors',
            field=models.ManyToManyField(blank=True, related_name='contributions', to=settings.AUTH_USER_MODEL, verbose_name='contributors'),
        ),
        migrations.AlterField(
            model_name='contribution',
            name='contributor',
            field=models.ForeignKey(blank=True, null=True, on_delete=django.db.models.deletion.PROTECT, related_name='old_contributions', to=settings.AUTH_USER_MODEL, verbose_name='contributor'),
        ),
        migrations.AlterUniqueTogether(
            name='contribution',
            unique_together=set(),
        ),
        migrations.RunPython(
            code=add_contributors_forward,
            reverse_code=add_contributors_backward,
        ),
        migrations.RemoveField(
            model_name='contribution',
            name='contributor',
        ),
    ]
